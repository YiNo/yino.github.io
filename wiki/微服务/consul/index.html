<!doctype html><html lang=en dir=ltr><head><meta name=generator content="Hugo 0.83.1"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="常用的服务发现 #  consul：常用于go-micro mdns: go-micro 默认自带的服务发现 etcd: k8s内嵌的服务发现 zookeeper: java中比较常用
简介 #  consul通过dns或者http接口使服务注册和服务发现变得很容易，一些外部服务，例如：saas提供的也可以一样注册
Consul： #  服务发现：consul通过dns或者http接口使服务注册和服务发现变得很容易，一些外部服务，例如：saas提供的也可以一样注册 健康检查：健康检测使consul可以快速的告警在集群中的操作。和服务发现的集成，可以防止服务转发到故障服务上面。（监测机制） 键/值存储：一些配置等 多数据中心：无需复杂的配置，即可支持任意数量的区域（最好是三台或者三台以上的consul在运行）
常用命令 #  consul agent
 -bind=0.0.0.0 指定consul 所在的机器IP地址。默认0.0.0.0 -http-port consul 自带的web访问的默认端口：8500 -client=127.0.0.1 表明哪些机器可以访问consul。默认本机。0.0.0.0所有机器均可访问 -config-dif=foo 所有主动注册服务的 描述信息 -data-dir=path 存储所有注册过来的server机器的详细信息。 -dev 开发者模式-node=hostname 服务发现的名字 -rejoin consul 启动的时候，加入到consul集群 -server 以服务方式开启consul,允许其他的consul连接到开启的consul上（形成集群）。如果不加-servr,表示以”客户端“的方式开启。不能被链接。 -ui 可以使用web界面来查看服务发现的详情  consul members：查看集群中有多少个成员
consul info: 查看当前consul他的ip等信息
consul leave： 优雅的关闭 consul。
测试 #  consul agent -server -bootstrap-expect 1 -data-dir /tmp/consul -node=n1 -bind=0."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content><meta property="og:description" content="常用的服务发现 #  consul：常用于go-micro mdns: go-micro 默认自带的服务发现 etcd: k8s内嵌的服务发现 zookeeper: java中比较常用
简介 #  consul通过dns或者http接口使服务注册和服务发现变得很容易，一些外部服务，例如：saas提供的也可以一样注册
Consul： #  服务发现：consul通过dns或者http接口使服务注册和服务发现变得很容易，一些外部服务，例如：saas提供的也可以一样注册 健康检查：健康检测使consul可以快速的告警在集群中的操作。和服务发现的集成，可以防止服务转发到故障服务上面。（监测机制） 键/值存储：一些配置等 多数据中心：无需复杂的配置，即可支持任意数量的区域（最好是三台或者三台以上的consul在运行）
常用命令 #  consul agent
 -bind=0.0.0.0 指定consul 所在的机器IP地址。默认0.0.0.0 -http-port consul 自带的web访问的默认端口：8500 -client=127.0.0.1 表明哪些机器可以访问consul。默认本机。0.0.0.0所有机器均可访问 -config-dif=foo 所有主动注册服务的 描述信息 -data-dir=path 存储所有注册过来的server机器的详细信息。 -dev 开发者模式-node=hostname 服务发现的名字 -rejoin consul 启动的时候，加入到consul集群 -server 以服务方式开启consul,允许其他的consul连接到开启的consul上（形成集群）。如果不加-servr,表示以”客户端“的方式开启。不能被链接。 -ui 可以使用web界面来查看服务发现的详情  consul members：查看集群中有多少个成员
consul info: 查看当前consul他的ip等信息
consul leave： 优雅的关闭 consul。
测试 #  consul agent -server -bootstrap-expect 1 -data-dir /tmp/consul -node=n1 -bind=0."><meta property="og:type" content="article"><meta property="og:url" content="https://kangkang17.cn/wiki/%E5%BE%AE%E6%9C%8D%E5%8A%A1/consul/"><meta property="article:section" content="wiki"><title>Consul | sun17 wiki</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.1639cc58b39d753e5ce211e45ca1950799431f352ff7bd1baadfa7fcedfe8043.css integrity="sha256-FjnMWLOddT5c4hHkXKGVB5lDHzUv970bqt+n/O3+gEM="><script defer src=/en.search.min.4ac2e915657abbf78364e0685f6e470769067e0500c7bbdd03487eb8a134d3b4.js integrity="sha256-SsLpFWV6u/eDZOBoX25HB2kGfgUAx7vdA0h+uKE007Q="></script><script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk="></script><link rel=apple-touch-icon sizes=128x128 href=128x128.jpg><script>var _hmt=_hmt||[];(function(){var a=document.createElement("script"),b;a.src="https://hm.baidu.com/hm.js?65e05e8c0631a0d2802629f8ceb31fee",b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(a,b),console.log("欢迎加入，https://airdb.dev"),console.log("Welcome，https://airdb.dev")})()</script><nav class="app-nav pc no-badge"><div class=logo><a href=//airdb.dev/ target=__blank class=dcloud-logo></a><a href=./ class="uniapp-logo active"></a></div><div class="search nav-search"><div class=input-wrap><input type=search id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class=clear-button><svg width="26" height="24"><circle cx="12" cy="12" r="11" fill="#ccc"/><path stroke="#fff" stroke-width="2" d="M8.25 8.25l7.5 7.5"/><path stroke="#fff" stroke-width="2" d="M8.25 15.75l7.5-7.5"/></svg></div></div><div class=results-panel></div></div><ul class=nav-url><li><a href=https://airdb.dev/hugo-book/>主题首页</a></li><li><a href=https://gohugo.io/getting-started/configuration>Hugo 配置</a></li><li><a href=https://github.com/airdb-wiki/hugo-book/actions>组件</a></li><li><a href=https://github.com/airdb-wiki/hugo-book/actions>APIs</a></li><li><a href=https://github.com/airdb-wiki/hugo-book/actions>Github Action</a></li></ul><ul class=nav-href><li class=ext-link><a href=https://themes.gohugo.io/hugo-book/ target=__blank>插件市场</a></li><li class=ext-link><a href=https://github.com/airdb-wiki/hugo-book/discussions target=__blank>讨论区</a></li><li><a href=//github.com/sponsors/airdb target=__blank style=color:#f60!important><img src=https://bjetxgzv.cdn.bspapp.com/VKCEYUGU-uni-app-doc/45e691f0-4f3d-11eb-b680-7980c8a877b8.png class=heart>赞助我们</a></li></ul><div class=github><a href=//github.com/airdb-wiki/hugo-book target=_blank><img src=https://bjetxgzv.cdn.bspapp.com/VKCEYUGU-uni-app-doc/44f8d690-4f3d-11eb-b680-7980c8a877b8.svg></a></div></nav></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><ul><li><a href=https://kangkang17.cn/wiki/Docker/>Docker</a><ul></ul></li><li><a href=https://kangkang17.cn/wiki/go/>Go</a><ul><li><a href=https://kangkang17.cn/wiki/go/go-laravel/>Go Laravel</a></li><li><a href=https://kangkang17.cn/wiki/go/Go%E5%B9%B6%E5%8F%91%E5%8E%9F%E7%90%86%E5%8F%8AGPM%E8%B0%83%E5%BA%A6%E7%AD%96%E7%95%A5/>Go并发原理及 Gpm调度策略</a></li><li><a href=https://kangkang17.cn/wiki/go/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/>垃圾回收</a></li></ul></li><li><a href=https://kangkang17.cn/wiki/Linux/>Linux</a><ul></ul></li><li><a href=https://kangkang17.cn/wiki/Mango/>Mango</a><ul></ul></li><li><a href=https://kangkang17.cn/wiki/MySql/>My SQL</a><ul><li><a href=https://kangkang17.cn/wiki/MySql/mysql%E5%BC%82%E6%AD%A5%E5%A4%8D%E5%88%B6/>Mysql异步复制</a></li><li><a href=https://kangkang17.cn/wiki/MySql/%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/>事务隔离级别</a></li><li><a href=https://kangkang17.cn/wiki/MySql/%E5%88%9B%E5%BB%BA%E5%87%BD%E6%95%B0/>创建函数</a></li><li><a href=https://kangkang17.cn/wiki/MySql/%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E5%B9%B6%E6%8E%88%E6%9D%83/>创建用户并授权</a></li><li><a href=https://kangkang17.cn/wiki/MySql/%E5%B8%B8%E8%A7%81%E5%87%BD%E6%95%B0/>常见函数</a></li><li><a href=https://kangkang17.cn/wiki/MySql/%E5%BF%98%E8%AE%B0%E5%AF%86%E7%A0%81/>忘记密码</a></li></ul></li><li><a href=https://kangkang17.cn/wiki/Nginx/>Nginx</a><ul></ul></li><li><a href=https://kangkang17.cn/wiki/PHP/>Php</a><ul><li><a href=https://kangkang17.cn/wiki/PHP/fpm%E4%BC%98%E5%8C%96/>Fpm优化</a></li><li><a href=https://kangkang17.cn/wiki/PHP/function/excel-export/>Excel Export</a></li><li><a href=https://kangkang17.cn/wiki/PHP/function/%E5%AF%B9%E8%B1%A1%E4%B8%8E%E6%95%B0%E7%BB%84%E7%9B%B8%E4%BA%92%E8%BD%AC%E6%8D%A2/>对象与数组相互转换</a></li><li><a href=https://kangkang17.cn/wiki/PHP/function/%E5%B8%B8%E7%94%A8header/>常用header</a></li></ul></li><li><a href=https://kangkang17.cn/wiki/Python/>Python</a><ul><li><a href=https://kangkang17.cn/wiki/Python/common-function/>Common Function</a></li><li><a href=https://kangkang17.cn/wiki/Python/queue/>Queue</a></li><li><a href=https://kangkang17.cn/wiki/Python/selenium/>Selenium</a></li><li><a href=https://kangkang17.cn/wiki/Python/tf-idf/>Tf IDF</a></li><li><a href=https://kangkang17.cn/wiki/Python/threading/>Threading</a></li><li><a href=https://kangkang17.cn/wiki/Python/uswgi%E4%B8%8Enginx/>Uswgi与nginx</a></li><li><a href=https://kangkang17.cn/wiki/Python/%E6%95%B0%E6%8D%AE%E9%9B%86/>数据集</a></li></ul></li><li><a href=https://kangkang17.cn/wiki/Redis/>Redis</a><ul></ul></li><li><a href=https://kangkang17.cn/wiki/VUE/>Vue</a><ul><li><a href=https://kangkang17.cn/wiki/VUE/iView%E6%A1%88%E4%BE%8B/>I View案例</a></li></ul></li><li><span>微服务</span><ul><li><a href=https://kangkang17.cn/wiki/%E5%BE%AE%E6%9C%8D%E5%8A%A1/consul/ class=active>Consul</a></li></ul></li></ul><div class=contact-item><div class=contact-smg><div>扫码添加企业微信</div><img src=https://airdb.dev/hugo-book/qrcode.png width=90 height=90></div></div></nav><script>(function(){var a=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Consul</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li><ul><li></li></ul></li></ul></li></ul></nav></aside></header><article class=markdown><h4 id=常用的服务发现>常用的服务发现
<a class=anchor href=#%e5%b8%b8%e7%94%a8%e7%9a%84%e6%9c%8d%e5%8a%a1%e5%8f%91%e7%8e%b0>#</a></h4><p>consul：常用于go-micro
mdns: go-micro 默认自带的服务发现
etcd: k8s内嵌的服务发现
zookeeper: java中比较常用</p><h5 id=简介>简介
<a class=anchor href=#%e7%ae%80%e4%bb%8b>#</a></h5><p>consul通过dns或者http接口使服务注册和服务发现变得很容易，一些外部服务，例如：saas提供的也可以一样注册</p><h5 id=consul>Consul：
<a class=anchor href=#consul>#</a></h5><p>服务发现：consul通过dns或者http接口使服务注册和服务发现变得很容易，一些外部服务，例如：saas提供的也可以一样注册
健康检查：健康检测使consul可以快速的告警在集群中的操作。和服务发现的集成，可以防止服务转发到故障服务上面。（监测机制）
键/值存储：一些配置等
多数据中心：无需复杂的配置，即可支持任意数量的区域（最好是三台或者三台以上的consul在运行）</p><h5 id=常用命令>常用命令
<a class=anchor href=#%e5%b8%b8%e7%94%a8%e5%91%bd%e4%bb%a4>#</a></h5><p>consul agent</p><ul><li>-bind=0.0.0.0 指定consul 所在的机器IP地址。默认0.0.0.0</li><li>-http-port consul 自带的web访问的默认端口：8500</li><li>-client=127.0.0.1 表明哪些机器可以访问consul。默认本机。0.0.0.0所有机器均可访问</li><li>-config-dif=foo 所有主动注册服务的 描述信息</li><li>-data-dir=path 存储所有注册过来的server机器的详细信息。</li><li>-dev 开发者模式-node=hostname 服务发现的名字</li><li>-rejoin consul 启动的时候，加入到consul集群</li><li>-server 以服务方式开启consul,允许其他的consul连接到开启的consul上（形成集群）。如果不加-servr,表示以”客户端“的方式开启。不能被链接。</li><li>-ui 可以使用web界面来查看服务发现的详情</li></ul><p>consul members：查看集群中有多少个成员</p><p>consul info: 查看当前consul他的ip等信息</p><p>consul leave： 优雅的关闭 consul。</p><h6 id=测试>测试
<a class=anchor href=#%e6%b5%8b%e8%af%95>#</a></h6><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>consul agent -server -bootstrap-expect <span style=color:#ae81ff>1</span> -data-dir /tmp/consul -node<span style=color:#f92672>=</span>n1 -bind<span style=color:#f92672>=</span>0.0.0.0 -ui -rejoin -config-dir<span style=color:#f92672>=</span>/etc/consul.d/ -client 0.0.0.0
</code></pre></div><h4 id=注册服务到consul步骤>注册服务到consul步骤：
<a class=anchor href=#%e6%b3%a8%e5%86%8c%e6%9c%8d%e5%8a%a1%e5%88%b0consul%e6%ad%a5%e9%aa%a4>#</a></h4><pre><code>1. 进入配置文件 /etc/consul.d/web.json
2. 创建web.json文件
3. 按json的语法，填写服务信息
4. 重新启动consul consul agent -server -bootstrap-expect 1 -data-dir /tmp/consul -node=n1 -bind=0.0.0.0 -ui -rejoin -config-dir=/etc/consul.d/ -client 0.0.0.0
5. 查看服务
    1. 浏览器查看
    2. curl -s 127.0.0.1:8500/v1/catalog/service/{servername}
</code></pre><h4 id=consul心跳检测>consul心跳检测
<a class=anchor href=#consul%e5%bf%83%e8%b7%b3%e6%a3%80%e6%b5%8b>#</a></h4><p>配置文件编写web.json(需重启)</p><pre><code>{
    &quot;service&quot;:{
            &quot;name&quot;: &quot;sunkang&quot;,
            &quot;tags&quot;: [&quot;rails&quot;],
            &quot;port&quot;: 9000,
            &quot;check&quot;: {
                    &quot;id&quot;: &quot;api&quot;,
                    &quot;name&quot;: &quot;sunkang check&quot;,
                    &quot;http&quot;: &quot;http://localhost:9000&quot;,
                    &quot;interval&quot;: &quot;10s&quot;,
                    &quot;timeout&quot;: &quot;1s&quot;
            }
    }
}

</code></pre><p>使用浏览器查看服务的健康状态
除了http实现健康检查外，还可以使用“脚本”、“tcp”、“ttl”方式进行健康检查。</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/sun17ya/sun17ya.github.io/edit/main/exampleSite/content/wiki/%e5%be%ae%e6%9c%8d%e5%8a%a1/consul.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li><ul><li></li></ul></li></ul></li></ul></nav></div></aside></main></body></html>