<!doctype html><html lang=en dir=ltr><head><meta name=generator content="Hugo 0.123.7"><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Prometheus # 简介 # Prometheus受启发于Google的Brogmon监控系统（相似的Kubernetes是从Google的Brog系统演变而来），从2012年开始由前Google工程师在Soundcloud以开源软件的形式进行研发，并且于2015年早期对外发布早期版本。2016年5月继Kubernetes之后成为第二个正式加入CNCF基金会的项目，同年6月正式发布1.0版本。2017年底发布了基于全新存储层的2.0版本，能更好地与容器平台、云平台配合。
监控的目的/重要性 # 在《SRE: Google运维解密》一书中指出，监控系统需要能够有效的支持白盒监控和黑盒监控。通过白盒能够了解其内部的实际运行状态，通过对监控指标的观察能够预判可能出现的问题，从而对潜在的不确定因素进行优化。而黑盒监控，常见的如HTTP探针，TCP探针等，可以在系统或者服务在发生故障时能够快速通知相关的人员进行处理。通过建立完善的监控体系，从而达到以下目的：
长期趋势分析：通过对监控样本数据的持续收集和统计，对监控指标进行长期趋势分析。例如，通过对磁盘空间增长率的判断，我们可以提前预测在未来什么时间节点上需要对资源进行扩容。 对照分析：两个版本的系统运行资源使用情况的差异如何？在不同容量情况下系统的并发和负载变化如何？通过监控能够方便的对系统进行跟踪和比较。 告警：当系统出现或者即将出现故障时，监控系统需要迅速反应并通知管理员，从而能够对问题进行快速的处理或者提前预防问题的发生，避免出现对业务的影响。 故障分析与定位：当问题发生后，需要对问题进行调查和处理。通过对不同监控监控以及历史数据的分析，能够找到并解决根源问题。 数据可视化：通过可视化仪表盘能够直接获取系统的运行状态、资源使用情况、以及服务运行状态等直观的信息。 Prometheus的优势 # Prometheus是一个开源的完整监控解决方案，其对传统监控系统的测试和告警模型进行了彻底的颠覆，形成了基于中央化的规则计算、统一分析和告警的新模型。 相比于传统监控系统Prometheus具有以下优点： 易于管理 # Prometheus核心部分只有一个单独的二进制文件，不存在任何的第三方依赖(数据库，缓存等等)。唯一需要的就是本地磁盘，因此不会有潜在级联故障的风险。 Prometheus基于Pull模型的架构方式，可以在任何地方（本地电脑，开发环境，测试环境）搭建我们的监控系统。对于一些复杂的情况，还可以使用Prometheus服务发现(Service Discovery)的能力动态管理监控目标。 监控服务的内部运行状态 # Pometheus鼓励用户监控服务的内部状态，基于Prometheus丰富的Client库，用户可以轻松的在应用程序中添加对Prometheus的支持，从而让用户可以获取服务和应用内部真正的运行状态。 强大的数据类型 # 强大的查询语言PromQL # 可扩展 # 易于集成 # 可视化 # 社区完善 # 社区中有很多现有开源方案 高效配合grafana 结构 # Prometheus Server (服务端 用于存储信息等) Prometheus client (客户端 用于收集信息，等待服务端采集) Prometheus Server # 从 https://prometheus.io/download/ 找到最新版的 Server软件包 Linux
export VERSION=2.4.3 curl -LO https://github.com/prometheus/prometheus/releases/download/v$VERSION/prometheus-$VERSION.darwin-amd64.tar. tar -xzf prometheus-${VERSION}.darwin-amd64.tar.gz cd prometheus-${VERSION}.darwin-amd64 解压后Prometheus配置文件orimethes.yml"><meta name=theme-color content="#FFFFFF"><meta property="og:title" content><meta property="og:description" content="Prometheus # 简介 # Prometheus受启发于Google的Brogmon监控系统（相似的Kubernetes是从Google的Brog系统演变而来），从2012年开始由前Google工程师在Soundcloud以开源软件的形式进行研发，并且于2015年早期对外发布早期版本。2016年5月继Kubernetes之后成为第二个正式加入CNCF基金会的项目，同年6月正式发布1.0版本。2017年底发布了基于全新存储层的2.0版本，能更好地与容器平台、云平台配合。
监控的目的/重要性 # 在《SRE: Google运维解密》一书中指出，监控系统需要能够有效的支持白盒监控和黑盒监控。通过白盒能够了解其内部的实际运行状态，通过对监控指标的观察能够预判可能出现的问题，从而对潜在的不确定因素进行优化。而黑盒监控，常见的如HTTP探针，TCP探针等，可以在系统或者服务在发生故障时能够快速通知相关的人员进行处理。通过建立完善的监控体系，从而达到以下目的：
长期趋势分析：通过对监控样本数据的持续收集和统计，对监控指标进行长期趋势分析。例如，通过对磁盘空间增长率的判断，我们可以提前预测在未来什么时间节点上需要对资源进行扩容。 对照分析：两个版本的系统运行资源使用情况的差异如何？在不同容量情况下系统的并发和负载变化如何？通过监控能够方便的对系统进行跟踪和比较。 告警：当系统出现或者即将出现故障时，监控系统需要迅速反应并通知管理员，从而能够对问题进行快速的处理或者提前预防问题的发生，避免出现对业务的影响。 故障分析与定位：当问题发生后，需要对问题进行调查和处理。通过对不同监控监控以及历史数据的分析，能够找到并解决根源问题。 数据可视化：通过可视化仪表盘能够直接获取系统的运行状态、资源使用情况、以及服务运行状态等直观的信息。 Prometheus的优势 # Prometheus是一个开源的完整监控解决方案，其对传统监控系统的测试和告警模型进行了彻底的颠覆，形成了基于中央化的规则计算、统一分析和告警的新模型。 相比于传统监控系统Prometheus具有以下优点： 易于管理 # Prometheus核心部分只有一个单独的二进制文件，不存在任何的第三方依赖(数据库，缓存等等)。唯一需要的就是本地磁盘，因此不会有潜在级联故障的风险。 Prometheus基于Pull模型的架构方式，可以在任何地方（本地电脑，开发环境，测试环境）搭建我们的监控系统。对于一些复杂的情况，还可以使用Prometheus服务发现(Service Discovery)的能力动态管理监控目标。 监控服务的内部运行状态 # Pometheus鼓励用户监控服务的内部状态，基于Prometheus丰富的Client库，用户可以轻松的在应用程序中添加对Prometheus的支持，从而让用户可以获取服务和应用内部真正的运行状态。 强大的数据类型 # 强大的查询语言PromQL # 可扩展 # 易于集成 # 可视化 # 社区完善 # 社区中有很多现有开源方案 高效配合grafana 结构 # Prometheus Server (服务端 用于存储信息等) Prometheus client (客户端 用于收集信息，等待服务端采集) Prometheus Server # 从 https://prometheus.io/download/ 找到最新版的 Server软件包 Linux
export VERSION=2.4.3 curl -LO https://github.com/prometheus/prometheus/releases/download/v$VERSION/prometheus-$VERSION.darwin-amd64.tar. tar -xzf prometheus-${VERSION}.darwin-amd64.tar.gz cd prometheus-${VERSION}.darwin-amd64 解压后Prometheus配置文件orimethes.yml"><meta property="og:type" content="article"><meta property="og:url" content="https://yino.github.io/wiki/Linux/Prometheus/"><meta property="article:section" content="wiki"><meta property="article:modified_time" content="2024-09-14T11:37:58+08:00"><title>Prometheus | sun17 wiki</title>
<link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.1639cc58b39d753e5ce211e45ca1950799431f352ff7bd1baadfa7fcedfe8043.css integrity="sha256-FjnMWLOddT5c4hHkXKGVB5lDHzUv970bqt+n/O3+gEM="><script defer src=/en.search.min.d110d89863acc53ad886dfd56e0afb27ef9a468b15a4a1bf2e3862fad81416b6.js integrity="sha256-0RDYmGOsxTrYht/Vbgr7J++aRosVpKG/Ljhi+tgUFrY="></script><script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk="></script><link rel=apple-touch-icon sizes=128x128 href=128x128.jpg><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?65e05e8c0631a0d2802629f8ceb31fee",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e),console.log("欢迎加入，https://airdb.dev"),console.log("Welcome，https://airdb.dev")})()</script><nav class="app-nav pc no-badge"><div class=logo><a href=//airdb.dev/ target=__blank class=dcloud-logo></a><a href=./ class="uniapp-logo active"></a></div><div class="search nav-search"><div class=input-wrap><input type=search id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class=clear-button><svg width="26" height="24"><circle cx="12" cy="12" r="11" fill="#ccc"/><path stroke="#fff" stroke-width="2" d="M8.25 8.25l7.5 7.5"/><path stroke="#fff" stroke-width="2" d="M8.25 15.75l7.5-7.5"/></svg></div></div><div class=results-panel></div></div><ul class=nav-url></ul><ul class=nav-href><li class=ext-link><a href=https://github.com/airdb-wiki/hugo-book/discussions target=__blank>讨论区</a></li><li><a href=//github.com/sponsors/airdb target=__blank style=color:#f60!important><img src=https://bjetxgzv.cdn.bspapp.com/VKCEYUGU-uni-app-doc/45e691f0-4f3d-11eb-b680-7980c8a877b8.png class=heart>赞助我们</a></li></ul><div class=github><a href=//github.com/airdb-wiki/hugo-book target=_blank><img src=https://bjetxgzv.cdn.bspapp.com/VKCEYUGU-uni-app-doc/44f8d690-4f3d-11eb-b680-7980c8a877b8.svg></a></div></nav></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><ul><li><input type=checkbox id=section-e89db1445f21a1db2f8a9248efa53681 class=toggle>
<label for=section-e89db1445f21a1db2f8a9248efa53681 class="flex justify-between"><a>Golang</a></label><ul><li><a href=https://yino.github.io/wiki/go/go-laravel/>Go Laravel</a></li><li><a href=https://yino.github.io/wiki/go/Go%E5%B9%B6%E5%8F%91%E5%8E%9F%E7%90%86%E5%8F%8AGPM%E8%B0%83%E5%BA%A6%E7%AD%96%E7%95%A5/>Go并发原理及 Gpm调度策略</a></li><li><a href=https://yino.github.io/wiki/go/one_way/>One Way</a></li><li><a href=https://yino.github.io/wiki/go/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/>垃圾回收</a></li><li><a href=https://yino.github.io/wiki/go/%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0%E5%BA%93/>常用函数库</a></li><li><a href=https://yino.github.io/wiki/go/%E7%99%BE%E4%B8%87%E8%81%8A%E5%A4%A9%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/>百万聊天系统架构</a></li></ul></li><li><input type=checkbox id=section-e4b47cb361013943d92c3d1b3a85155b class=toggle>
<label for=section-e4b47cb361013943d92c3d1b3a85155b class="flex justify-between"><a>PHP</a></label><ul><li><a href=https://yino.github.io/wiki/PHP/fpm%E4%BC%98%E5%8C%96/>Fpm优化</a></li><li><a href=https://yino.github.io/wiki/PHP/function/excel-export/>Excel Export</a></li><li><a href=https://yino.github.io/wiki/PHP/function/%E5%AF%B9%E8%B1%A1%E4%B8%8E%E6%95%B0%E7%BB%84%E7%9B%B8%E4%BA%92%E8%BD%AC%E6%8D%A2/>对象与数组相互转换</a></li><li><a href=https://yino.github.io/wiki/PHP/function/%E5%B8%B8%E7%94%A8header/>常用header</a></li></ul></li><li><input type=checkbox id=section-56d67aeb85c3ecad70d4d358142db3b3 class=toggle>
<label for=section-56d67aeb85c3ecad70d4d358142db3b3 class="flex justify-between"><a>Python</a></label><ul><li><a href=https://yino.github.io/wiki/Python/common-function/>Common Function</a></li><li><a href=https://yino.github.io/wiki/Python/queue/>Queue</a></li><li><a href=https://yino.github.io/wiki/Python/selenium/>Selenium</a></li><li><a href=https://yino.github.io/wiki/Python/tf-idf/>Tf IDF</a></li><li><a href=https://yino.github.io/wiki/Python/threading/>Threading</a></li><li><a href=https://yino.github.io/wiki/Python/uswgi%E4%B8%8Enginx/>Uswgi与nginx</a></li><li><a href=https://yino.github.io/wiki/Python/%E6%95%B0%E6%8D%AE%E9%9B%86/>数据集</a></li></ul></li><li><input type=checkbox id=section-290e3c753807472c4a11761414c856fd class=toggle>
<label for=section-290e3c753807472c4a11761414c856fd class="flex justify-between"><a>VUE</a></label><ul><li><a href=https://yino.github.io/wiki/VUE/iView%E6%A1%88%E4%BE%8B/>I View案例</a></li></ul></li><li><input type=checkbox id=section-d3e74333b2ccb96d676242a4ef988186 class=toggle>
<label for=section-d3e74333b2ccb96d676242a4ef988186 class="flex justify-between"><a>MySql</a></label><ul><li><a href=https://yino.github.io/wiki/MySql/mysql%E5%BC%82%E6%AD%A5%E5%A4%8D%E5%88%B6/>Mysql异步复制</a></li><li><a href=https://yino.github.io/wiki/MySql/%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/>事务隔离级别</a></li><li><a href=https://yino.github.io/wiki/MySql/%E5%88%9B%E5%BB%BA%E5%87%BD%E6%95%B0/>创建函数</a></li><li><a href=https://yino.github.io/wiki/MySql/%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E5%B9%B6%E6%8E%88%E6%9D%83/>创建用户并授权</a></li><li><a href=https://yino.github.io/wiki/MySql/%E5%B8%B8%E8%A7%81%E5%87%BD%E6%95%B0/>常见函数</a></li><li><a href=https://yino.github.io/wiki/MySql/%E5%BF%98%E8%AE%B0%E5%AF%86%E7%A0%81/>忘记密码</a></li></ul></li><li><input type=checkbox id=section-fbf96c40060222e6abb418fd9a6bc7e5 class=toggle>
<label for=section-fbf96c40060222e6abb418fd9a6bc7e5 class="flex justify-between"><a>Redis</a></label><ul><li><a href=https://yino.github.io/wiki/Redis/%E5%BC%82%E6%AD%A5%E5%A4%8D%E5%88%B6/>异步复制</a></li></ul></li><li><input type=checkbox id=section-6da4cf37de0c2f2fde13cc4c178f792b class=toggle>
<label for=section-6da4cf37de0c2f2fde13cc4c178f792b class="flex justify-between"><a>Mango</a></label><ul></ul></li><li><input type=checkbox id=section-38d3becc35e924b35eb3daa5a1e6504d class=toggle>
<label for=section-38d3becc35e924b35eb3daa5a1e6504d class="flex justify-between"><a>Docker</a></label><ul><li><a href=https://yino.github.io/wiki/Docker/Dockerfile/>Dockerfile</a></li><li><a href=https://yino.github.io/wiki/Docker/nginx-php-mysql%E4%B8%80%E4%BB%B6%E9%83%A8%E7%BD%B2/>Nginx Php Mysql一件部署</a></li><li><a href=https://yino.github.io/wiki/Docker/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/>常用命令</a></li></ul></li><li><input type=checkbox id=section-d9101885ad911559b7cf9f595ebaf7bd class=toggle>
<label for=section-d9101885ad911559b7cf9f595ebaf7bd class="flex justify-between"><a>Nginx</a></label><ul><li><a href=https://yino.github.io/wiki/Nginx/rewrite%E4%B8%8Eproxy_pass/>Rewrite与proxy Pass</a></li><li><a href=https://yino.github.io/wiki/Nginx/%E7%A6%81%E7%BD%91%E6%AE%B5/>禁网段</a></li></ul></li><li><input type=checkbox id=section-da074c18303a1ad12b6ba4fe6f70f667 class=toggle checked>
<label for=section-da074c18303a1ad12b6ba4fe6f70f667 class="flex justify-between"><a>Linux</a></label><ul><li><a href=https://yino.github.io/wiki/Linux/CentOS%E6%90%AD%E5%BB%BAShadowsocks%E6%9C%8D%E5%8A%A1%E7%AB%AF/>Cent Os搭建 Shadowsocks服务端</a></li><li><a href=https://yino.github.io/wiki/Linux/Prometheus/ class=active>Prometheus</a></li><li><a href=https://yino.github.io/wiki/Linux/%E5%88%86%E7%BB%84/>分组</a></li><li><a href=https://yino.github.io/wiki/Linux/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/>常用命令</a></li></ul></li><li><input type=checkbox id=section-a56d65510185b81503293e88d070df19 class=toggle>
<label for=section-a56d65510185b81503293e88d070df19 class="flex justify-between"><a>微服务</a></label><ul><li><a href=https://yino.github.io/wiki/%E5%BE%AE%E6%9C%8D%E5%8A%A1/consul/>Consul</a></li></ul></li><li><input type=checkbox id=section-9a2f275de5a06924130cde8cb78c8bc3 class=toggle>
<label for=section-9a2f275de5a06924130cde8cb78c8bc3 class="flex justify-between"><a>领域驱动设计</a></label><ul><li><a href=https://yino.github.io/wiki/DDD/domain/>Domain</a></li><li><a href=https://yino.github.io/wiki/DDD/PO-DO-VO-DTO/>Po Do Vo Dto</a></li><li><a href=https://yino.github.io/wiki/DDD/%E5%AE%9E%E8%B7%B5/>实践</a></li><li><a href=https://yino.github.io/wiki/DDD/%E6%AD%A5%E9%AA%A4/>步骤</a></li><li><a href=https://yino.github.io/wiki/DDD/%E7%A4%BA%E4%BE%8B/>示例</a></li><li><a href=https://yino.github.io/wiki/DDD/%E8%81%9A%E5%90%88/>聚合</a></li></ul></li><li><input type=checkbox id=section-360d6906cb2b7438909fd98a7c415e74 class=toggle>
<label for=section-360d6906cb2b7438909fd98a7c415e74 class="flex justify-between"><a>规划</a></label><ul><li><a href=https://yino.github.io/wiki/Target/program/>Program</a></li><li><a href=https://yino.github.io/wiki/Target/target/>Target</a></li></ul></li></ul><div class=contact-item><div class=contact-smg><div>扫码添加企业微信</div><img src=https://airdb.dev/hugo-book/qrcode.png width=90 height=90></div></div></nav><script>(function(){var e=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>Prometheus</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#prometheus>Prometheus</a><ul><li><a href=#简介>简介</a></li><li><a href=#监控的目的重要性>监控的目的/重要性</a></li><li><a href=#prometheus的优势>Prometheus的优势</a><ul><li><a href=#易于管理>易于管理</a></li><li><a href=#监控服务的内部运行状态>监控服务的内部运行状态</a></li><li><a href=#强大的数据类型>强大的数据类型</a></li><li><a href=#强大的查询语言promql>强大的查询语言PromQL</a></li><li><a href=#可扩展>可扩展</a></li><li><a href=#易于集成>易于集成</a></li><li><a href=#可视化>可视化</a></li><li><a href=#社区完善>社区完善</a></li></ul></li><li><a href=#结构>结构</a><ul><li><a href=#prometheus-server>Prometheus Server</a></li><li><a href=#prometheus-client>Prometheus client</a></li><li><a href=#配置grafana>配置Grafana</a></li></ul></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=prometheus>Prometheus
<a class=anchor href=#prometheus>#</a></h1><h2 id=简介>简介
<a class=anchor href=#%e7%ae%80%e4%bb%8b>#</a></h2><p>Prometheus受启发于Google的Brogmon监控系统（相似的Kubernetes是从Google的Brog系统演变而来），从2012年开始由前Google工程师在Soundcloud以开源软件的形式进行研发，并且于2015年早期对外发布早期版本。2016年5月继Kubernetes之后成为第二个正式加入CNCF基金会的项目，同年6月正式发布1.0版本。2017年底发布了基于全新存储层的2.0版本，能更好地与容器平台、云平台配合。</p><h2 id=监控的目的重要性>监控的目的/重要性
<a class=anchor href=#%e7%9b%91%e6%8e%a7%e7%9a%84%e7%9b%ae%e7%9a%84%e9%87%8d%e8%a6%81%e6%80%a7>#</a></h2><p>在《SRE: Google运维解密》一书中指出，监控系统需要能够有效的支持白盒监控和黑盒监控。通过白盒能够了解其内部的实际运行状态，通过对监控指标的观察能够预判可能出现的问题，从而对潜在的不确定因素进行优化。而黑盒监控，常见的如HTTP探针，TCP探针等，可以在系统或者服务在发生故障时能够快速通知相关的人员进行处理。通过建立完善的监控体系，从而达到以下目的：</p><ul><li>长期趋势分析：通过对监控样本数据的持续收集和统计，对监控指标进行长期趋势分析。例如，通过对磁盘空间增长率的判断，我们可以提前预测在未来什么时间节点上需要对资源进行扩容。</li><li>对照分析：两个版本的系统运行资源使用情况的差异如何？在不同容量情况下系统的并发和负载变化如何？通过监控能够方便的对系统进行跟踪和比较。</li><li>告警：当系统出现或者即将出现故障时，监控系统需要迅速反应并通知管理员，从而能够对问题进行快速的处理或者提前预防问题的发生，避免出现对业务的影响。
故障分析与定位：当问题发生后，需要对问题进行调查和处理。通过对不同监控监控以及历史数据的分析，能够找到并解决根源问题。</li><li>数据可视化：通过可视化仪表盘能够直接获取系统的运行状态、资源使用情况、以及服务运行状态等直观的信息。</li></ul><h2 id=prometheus的优势>Prometheus的优势
<a class=anchor href=#prometheus%e7%9a%84%e4%bc%98%e5%8a%bf>#</a></h2><pre><code>Prometheus是一个开源的完整监控解决方案，其对传统监控系统的测试和告警模型进行了彻底的颠覆，形成了基于中央化的规则计算、统一分析和告警的新模型。 相比于传统监控系统Prometheus具有以下优点：
</code></pre><h3 id=易于管理>易于管理
<a class=anchor href=#%e6%98%93%e4%ba%8e%e7%ae%a1%e7%90%86>#</a></h3><pre><code>Prometheus核心部分只有一个单独的二进制文件，不存在任何的第三方依赖(数据库，缓存等等)。唯一需要的就是本地磁盘，因此不会有潜在级联故障的风险。
Prometheus基于Pull模型的架构方式，可以在任何地方（本地电脑，开发环境，测试环境）搭建我们的监控系统。对于一些复杂的情况，还可以使用Prometheus服务发现(Service Discovery)的能力动态管理监控目标。
</code></pre><h3 id=监控服务的内部运行状态>监控服务的内部运行状态
<a class=anchor href=#%e7%9b%91%e6%8e%a7%e6%9c%8d%e5%8a%a1%e7%9a%84%e5%86%85%e9%83%a8%e8%bf%90%e8%a1%8c%e7%8a%b6%e6%80%81>#</a></h3><pre><code>Pometheus鼓励用户监控服务的内部状态，基于Prometheus丰富的Client库，用户可以轻松的在应用程序中添加对Prometheus的支持，从而让用户可以获取服务和应用内部真正的运行状态。
</code></pre><h3 id=强大的数据类型>强大的数据类型
<a class=anchor href=#%e5%bc%ba%e5%a4%a7%e7%9a%84%e6%95%b0%e6%8d%ae%e7%b1%bb%e5%9e%8b>#</a></h3><h3 id=强大的查询语言promql>强大的查询语言PromQL
<a class=anchor href=#%e5%bc%ba%e5%a4%a7%e7%9a%84%e6%9f%a5%e8%af%a2%e8%af%ad%e8%a8%80promql>#</a></h3><h3 id=可扩展>可扩展
<a class=anchor href=#%e5%8f%af%e6%89%a9%e5%b1%95>#</a></h3><h3 id=易于集成>易于集成
<a class=anchor href=#%e6%98%93%e4%ba%8e%e9%9b%86%e6%88%90>#</a></h3><h3 id=可视化>可视化
<a class=anchor href=#%e5%8f%af%e8%a7%86%e5%8c%96>#</a></h3><h3 id=社区完善>社区完善
<a class=anchor href=#%e7%a4%be%e5%8c%ba%e5%ae%8c%e5%96%84>#</a></h3><pre><code>社区中有很多现有开源方案 高效配合grafana
</code></pre><h2 id=结构>结构
<a class=anchor href=#%e7%bb%93%e6%9e%84>#</a></h2><ul><li>Prometheus Server (服务端 用于存储信息等)</li><li>Prometheus client (客户端 用于收集信息，等待服务端采集)</li></ul><h3 id=prometheus-server>Prometheus Server
<a class=anchor href=#prometheus-server>#</a></h3><p>从
<a href=https://prometheus.io/download/>https://prometheus.io/download/</a> 找到最新版的 Server软件包
Linux</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>export VERSION<span style=color:#f92672>=</span>2.4.3
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>curl -LO  https://github.com/prometheus/prometheus/releases/download/v$VERSION/prometheus-$VERSION.darwin-amd64.tar.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>tar -xzf prometheus-<span style=color:#e6db74>${</span>VERSION<span style=color:#e6db74>}</span>.darwin-amd64.tar.gz
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cd prometheus-<span style=color:#e6db74>${</span>VERSION<span style=color:#e6db74>}</span>.darwin-amd64
</span></span></code></pre></div><p>解压后Prometheus配置文件orimethes.yml</p><pre tabindex=0><code># my global config
global:
  scrape_interval:     15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.
  evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.
  # scrape_timeout is set to the global default (10s).
# Alertmanager configuration
alerting:
  alertmanagers:
  - static_configs:
    - targets:
      # - alertmanager:9093
# Load rules once and periodically evaluate them according to the global &#39;evaluation_interval&#39;.
rule_files:
  # - &#34;first_rules.yml&#34;
  # - &#34;second_rules.yml&#34;
# A scrape configuration containing exactly one endpoint to scrape:
# Here it&#39;s Prometheus itself.
scrape_configs:
  # The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.
  - job_name: &#39;prometheus&#39;
    # metrics_path defaults to &#39;/metrics&#39;
    # scheme defaults to &#39;http&#39;.
    static_configs:
    - targets: [&#39;localhost:9090&#39;]
</code></pre><p>Promtheus作为一个时间序列数据库，其采集的数据会以文件的形式存储在本地中，默认的存储路径为data/，因此我们需要先手动创建该目录：</p><p>用户也可以通过参数&ndash;storage.tsdb.path=&ldquo;data/&ldquo;修改本地数据存储的路径。</p><p>启动prometheus服务，其会默认加载当前路径下的prometheus.yaml文件;</p><p>成功后 访问 http://localhost:9090 会看到Prometheus UI</p><h3 id=prometheus-client>Prometheus client
<a class=anchor href=#prometheus-client>#</a></h3><p>客户端分为多种类型
<a href=https://prometheus.io/download/#node_exporter>官方支持</a></p><ul><li>blackbox_exporter</li><li>consul_exporter</li><li>graphite_exporter</li><li>memcached_exporter （memcache 缓存）</li><li>mysqld_exporter （MySQL 监控）</li><li>node_exporter （常用 服务器配置）</li><li>nginx_exporter (
<a href=https://github.com/nginxinc/nginx-prometheus-exporter>社区</a> 官方不支持 需要引用开源社区的)</li></ul><h4 id=配置示例>配置示例
<a class=anchor href=#%e9%85%8d%e7%bd%ae%e7%a4%ba%e4%be%8b>#</a></h4><p>在需要服务器监控的节点中下载</p><h5 id=node_exporter>node_exporter
<a class=anchor href=#node_exporter>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -OL https://github.com/prometheus/node_exporter/releases/download/v1.8.2/node_exporter-1.8.2.linux-amd64.tar.gz
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>tar -xzf node_exporter-1.8.2.linux-amd64.tar.gz
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cd node_exporter-1.8.2.linux-amd64
</span></span><span style=display:flex><span><span style=color:#75715e># 运行 二进制文件 端口是 9100</span>
</span></span><span style=display:flex><span>./node_exporter/node_exporter
</span></span></code></pre></div><h5 id=nginx_exporter>nginx_exporter
<a class=anchor href=#nginx_exporter>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -OL https://github.com/nginxinc/nginx-prometheus-exporter/releases/download/v1.3.0/nginx-prometheus-exporter_1.3.0_linux_amd64.tar.gz
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>tar -xzf nginx-prometheus-exporter_1.3.0_linux_amd64.tar.gz
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cd nginx-prometheus-exporter_1.3.0_linux_amd64
</span></span><span style=display:flex><span><span style=color:#75715e># 运行 二进制文件 端口是 9113</span>
</span></span><span style=display:flex><span>./nginx_exporter/nginx_exporter
</span></span></code></pre></div><h5 id=配置-prometheus-server>配置 Prometheus Server
<a class=anchor href=#%e9%85%8d%e7%bd%ae-prometheus-server>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>global</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>scrape_interval</span>:     <span style=color:#ae81ff>5s</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>evaluation_interval</span>: <span style=color:#ae81ff>5s</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>external_labels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>monitor</span>: <span style=color:#e6db74>&#39;dashboard&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alerting</span>:
</span></span><span style=display:flex><span> <span style=color:#f92672>alertmanagers</span>:
</span></span><span style=display:flex><span> - <span style=color:#f92672>static_configs</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>targets</span>:
</span></span><span style=display:flex><span>        - <span style=color:#e6db74>&#34;192.168.0.100:9093&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>rule_files</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>/etc/prometheus/rules/*.rules</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>scrape_configs</span>:  
</span></span><span style=display:flex><span>  - <span style=color:#f92672>job_name</span>: <span style=color:#e6db74>&#39;prometheus&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>scrape_interval</span>: <span style=color:#ae81ff>5s</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>static_configs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>targets</span>: [<span style=color:#e6db74>&#39;prometheus:9090&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>job_name</span>: <span style=color:#ae81ff>node</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>static_configs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>targets</span>: [<span style=color:#e6db74>&#39;172.20.0.10:9113&#39;</span>,<span style=color:#e6db74>&#39;172.20.0.9:9100&#39;</span>, <span style=color:#e6db74>&#39;172.20.0.6:9100&#39;</span>]
</span></span></code></pre></div><h3 id=配置grafana>配置Grafana
<a class=anchor href=#%e9%85%8d%e7%bd%aegrafana>#</a></h3><p>建议用docker部署</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>grafana</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>grafana/grafana</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>grafana</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>user</span>: <span style=color:#ae81ff>root</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#    restart: always</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;3000:3000&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      <span style=color:#75715e>#- ./conf/grafana:/etc/grafana</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./prometheus/data/prometheus/grafana_data:/var/lib/grafana</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>GF_SECURITY_ADMIN_PASSWORD</span>: <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>GF_SECURITY_DISABLE_LOGIN_FORM</span>: <span style=color:#e6db74>&#34;true&#34;</span>
</span></span></code></pre></div><h4 id=配置-node_exporter-面板>配置 node_exporter 面板
<a class=anchor href=#%e9%85%8d%e7%bd%ae-node_exporter-%e9%9d%a2%e6%9d%bf>#</a></h4><ol><li>选择datasource &ldquo;prometheus&rdquo;</li><li><a href=https://grafana.com/grafana/dashboards/?>dashboard</a> 在此连接中选择合适的即可</li></ol><h4 id=配置--nginx_exporter>配置 nginx_exporter
<a class=anchor href=#%e9%85%8d%e7%bd%ae--nginx_exporter>#</a></h4><ol><li>选择datasource &ldquo;prometheus&rdquo;</li><li><a href=https://grafana.com/grafana/dashboards/?>dashboard</a> 在此连接中选择合适的即可</li></ol></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/yino/yino.github.io/commit/57497c5bcd574fb5495ecfeaa413816a7fe4cfd5 title='Last modified by yuyi | Sat Sep 14 03:37:58 UTC 2024' target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>Sat Sep 14 03:37:58 UTC 2024</span></a></div><div><a class="flex align-center" href=https://github.com/yino/yino.github.io/edit/main/exampleSite/content/wiki/Linux/Prometheus.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#prometheus>Prometheus</a><ul><li><a href=#简介>简介</a></li><li><a href=#监控的目的重要性>监控的目的/重要性</a></li><li><a href=#prometheus的优势>Prometheus的优势</a><ul><li><a href=#易于管理>易于管理</a></li><li><a href=#监控服务的内部运行状态>监控服务的内部运行状态</a></li><li><a href=#强大的数据类型>强大的数据类型</a></li><li><a href=#强大的查询语言promql>强大的查询语言PromQL</a></li><li><a href=#可扩展>可扩展</a></li><li><a href=#易于集成>易于集成</a></li><li><a href=#可视化>可视化</a></li><li><a href=#社区完善>社区完善</a></li></ul></li><li><a href=#结构>结构</a><ul><li><a href=#prometheus-server>Prometheus Server</a></li><li><a href=#prometheus-client>Prometheus client</a></li><li><a href=#配置grafana>配置Grafana</a></li></ul></li></ul></li></ul></nav></div></aside></main></body></html>